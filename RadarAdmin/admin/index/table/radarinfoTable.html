<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>雷达信息表</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
  <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
  <script src="https://cdn.bootcss.com/datatables/1.10.16/js/jquery.dataTables.js"></script>
  <style>
    .content {
      margin: 50px auto;
      border: 1px solid #ccc;
    }

    .operation {
      margin: 10px;
    }

    .operation>button {
      margin: 10px;
    }

    #books_length {
      float: left;
      margin-left: 20px;
    }

    #books_filter {
      float: right;
      margin-right: 20px;
    }

    #books {
      margin: 5px;
    }

    .center-block {
      display: block;
      width: 21%;
      margin: auto;
    }
  </style>
</head>
<body>
  <section class="content">
    <div class="btn-group operation">
      <button id="btn_add" type="button" class="btn bg-primary">
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
      </button>
      <button id="btn_edit" type="button" class="btn bg-info">
        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
      </button>
      <button id="btn_delete" type="button" class="btn btn-success">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
      </button>
    </div>
    <div class="modal fade" id="addBook" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">添加设备信息</h4>
          </div>
          <div id="addBookModal" class="modal-body">
            <div class="form-horizontal">
              <div class="form-group">
                <label for="radarmaintenanceId" class="col-sm-2 control-label">radarinfoId:*</label>
                <div class="col-sm-10">
                  <input class="form-control" id="1" type="text">
                </div>
              </div>
              <div class="form-group">
                <label for="设备编号" class="col-sm-2 control-label">设备编号:*</label>
                <div class="col-sm-10">
                  <input class="form-control" id="2" type="text">
                </div>
              </div>
              <div class="form-group">
                <label for="设备名称" class="col-sm-2 control-label">设备名称:*</label>
                <div class="col-sm-10">
                  <input class="form-control" id="3" type="text">
                </div>
              </div>
              <div class="form-group">
                <label for="任务编号" class="col-sm-2 control-label">生产日期:*</label>
                <div class="col-sm-10">
                  <input class="form-control" id="4" type="text">
                </div>
              </div>
              <div class="form-group">
                <label for="故障原因" class="col-sm-2 control-label">生产厂家:*</label>
                <div class="col-sm-10">
                  <input class="form-control" id="5" type="text">
                </div>
              </div>
              <div class="form-group">
                <label for="解决方法" class="col-sm-2 control-label">雷达部署情况:*</label>
                <div class="col-sm-10">
                  <input class="form-control" id="6" type="text">
                </div>
              </div>
              <div class="form-group">
                <label for="维修进度" class="col-sm-2 control-label">维修进度:*</label>
                <div class="col-sm-10">
                    <input class="form-control" list="browsers" id="9" type="text">
                    <datalist id="browsers">
                        <option value="待维修">
                        <option value="未维修">
                        <option value="维修完成">
                    </datalist>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <div class="center-block">
              <button id="addBooksInfo" type="button" class="btn btn-success" data-dismiss="modal">保存</button>
              <button id="cancelAdd" type="button" class="btn btn-default" data-dismiss="modal">取消</button>
              <!--<button id="onload" type="button"  data-dismiss="modal" onclick="getUser()">上传</button>-->
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="editBookInfo" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">修改雷达信息</h4>
            </div>
            <div id="editBookModal" class="modal-body">
              <div class="form-horizontal">
                <div class="form-group">
                  <label for="editBookName" class="col-sm-2 control-label">ID:*</label>
                  <div class="col-sm-10">
                    <input class="form-control" id="editBookName" type="text">
                  </div>
                </div>
                <div class="form-group">
                  <label for="editBookAuthor" class="col-sm-2 control-label">设备编号:*</label>
                  <div class="col-sm-10">
                    <input class="form-control" id="editBookAuthor" type="text">
                  </div>
                </div>
                <div class="form-group">
                  <label for="editBookPrice" class="col-sm-2 control-label">设备名称:*</label>
                  <div class="col-sm-10">
                    <input class="form-control" id="editBookPrice" type="text">
                  </div>
                </div>
                <div class="form-group">
                  <label for="editBookPublish" class="col-sm-2 control-label">生产日期:*</label>
                  <div class="col-sm-10">
                    <input class="form-control" id="editBookPublish" type="text">
                  </div>
                </div>
                <div class="form-group">
                  <label for="editBookPublish" class="col-sm-2 control-label">生产厂家:*</label>
                  <div class="col-sm-10">
                    <input class="form-control" id="editBookPublish" type="text">
                  </div>
                </div>
                <div class="form-group">
                  <label for="editBookPublish" class="col-sm-2 control-label">雷达部署情况:*</label>
                  <div class="col-sm-10">
                    <input class="form-control" id="editBookPublish" type="text">
                  </div>
                </div>
                <div class="form-group">
                  <label for="editBookPublish" class="col-sm-2 control-label">维修状态:*</label>
                  <div class="col-sm-10">
                    <input class="form-control" list = "browsers"  id="editBookPublish" type="text">
                    <datalist id="browsers">
                      <option value="待维修">
                      <option value="未维修">
                      <option value="维修完成">
                  </datalist>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <div class="center-block">
                <button id="saveEdit" type="button" class="btn btn-success" data-dismiss="modal">保存</button>
                <button id="cancelEdit" type="button" class="btn btn-default" data-dismiss="modal">取消</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    <div class="modal fade" id="deleteBook" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">确认要删除吗？</h4>
          </div>
          <div class="modal-footer">
            <button id="delete" type="button" class="btn btn-danger" data-dismiss="modal">删除</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
          </div>
        </div>
      </div>
    </div>
      
    <table id="任务基本属性" class="table table-striped table-bordered row-border hover order-column" cellspacing="0" width="100%">
      <thead>
        <tr>
          <th>radarinfoId</th>
          <th>设备编号</th>
          <th>设备名称</th>
          <th>生产日期</th>
          <th>生产厂家</th>
          <th>雷达部署情况</th>
          <th>维修状态</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
</body>
<script>
  let serveUrl = 'http://202.114.41.165:8080/radar_db'
  var data = ['49288-0957']
  var titles = ['任务编号', '任务名称', '维修设备名称', '维修设备编号', '任务开始时间','任务维修周期','负责部门','负责人','任务状态']
  $(function () {
    var table = $('#任务基本属性').DataTable({
      "ajax":serveUrl + "/RadarinfoSelect",
    
      "columns": [
                { "data": "radarinfoId" },
                { "data": "radarNo" },
                { "data": "radarName" },
                { "data": "productionDate" },
                { "data": "manufacture" },
                { "data": "radarDeployment" },
                { "data": "serviceStatus" },
                ],

      "pagingType": "full_numbers",
      "bSort": true,
      "language": {
        "sProcessing": "处理中...",
        "sLengthMenu": "显示 _MENU_ 项结果",
        "sZeroRecords": "没有匹配结果",
        "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
        "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
        "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
        "sInfoPostFix": "",
        "sSearch": "搜索:",
        "sUrl": "",
        "sEmptyTable": "表中数据为空",
        "sLoadingRecords": "载入中...",
        "sInfoThousands": ",",
        "oPaginate": {
            "sFirst": "首页",
            "sPrevious": "上页",
            "sNext": "下页",
            "sLast": "末页"
        },
        "oAria": {
            "sSortAscending": ": 以升序排列此列",
            "sSortDescending": ": 以降序排列此列"
        }
      },
      "columnDefs": [{
        "searchable": false,
        "orderable": true,
        "targets": 0
      }],
      "order": [[1, 'asc']]
      
    });


    //table.on('order.dt search.dt', function() {
    //  table.column(0, {
    //   search: 'applied',
    //    order: 'applied'
    //  }).nodes().each(function(cell, i) {
    //    cell.innerHTML = i + 1;
    // });
    //}).draw();    //  第一列变成了顺序编号

    $('#任务基本属性 tbody').on('click', 'tr', function () {
      if ( $(this).hasClass('selected') ) {
        $(this).removeClass('selected');
      }
      else {
        table.$('tr.selected').removeClass('selected');
        $(this).addClass('selected');
      }
    });

    $("#cancelAdd").on('click', function() {
      console.log('cancelAdd');
      $("#addBookModal").find('input').val('')
    })

    $("#addBooksInfo").on('click', function() {
      console.log('addBooksInfo');
      $.ajax({
          url:  "http://127.0.0.1:8081/login",                                          //后台提供的服务器（接口） config.baseServerUrl + '/account/login', 
          type: 'post',                                               //请求方式是post
          data: { radarmaintenanceId: document.getElementById("1").value, 
                  radarNo: document.getElementById("2").value, 
                  radarName: document.getElementById("3").value,
                  taskNo: document.getElementById("4").value,
                  faultReason: document.getElementById("5").value,
                  solution: document.getElementById("6").value, 
                  serviceman: document.getElementById("7").value,
                  servicemanNo: document.getElementById("8").value,
                  schedule: document.getElementById("9").value},
          

      })

      if (data.length) {
        if ($("#addBookModal").find('input').val() !== '') {
          var 任务编号 = $("#1").val()
          var 任务名称 = $("#2").val()
          var 维修设备名称 = $("#3").val()
          var 维修设备编号 = $("#4").val()
          var 任务开始时间 = $("#5").val()
          var 任务维修周期 = $("#6").val()
          var 负责部门 = $("#7").val()
          var 负责人 = $("#8").val()
          var 任务状态 = $("#9").val()

          var addInfos = [].concat(任务编号, 任务名称, 维修设备名称, 维修设备编号, 任务开始时间, 任务维修周期,负责部门 ,负责人,任务状态);
          alert(addInfos);
          for (var i = 0; i < addInfos.length; i++) {
            if (addBookInfos[i] === '') {
              alert(titles[i] + '内容不能为空')
            }
          }
          table.row.add([任务编号, 任务名称, 维修设备名称, 维修设备编号, 任务开始时间, 任务维修周期,负责部门 ,负责人,任务状态]).draw();
          $("#addBookModal").find('input').val(任务编号)
        }
      } else {
        alert('请输入内容')
      }

    })
    //$("#addBooksInfo").click();    

    $("#btn_add").click(function(){
      console.log('add');
      $("#addBook").modal()
    });

    $('#btn_edit').click(function () {
      console.log('edit');
      if (table.rows('.selected').data().length) {
        $("#editBookInfo").modal()
        var rowData = table.rows('.selected').data()[0];
        var inputs = $("#editBookModal").find('input')
        for (var i = 0; i < inputs.length; i++) {
          $(inputs[i]).val(rowData[i + 1])
        }
      } else {
        alert('请选择项目');
      }
    });

    $("#saveEdit").click(function() {
      var editBookName = $("#editBookName").val()
      var editBookAuthor = $("#editBookAuthor").val()
      var editBookPrice = $("#editBookPrice").val()
      var editBookPublish = $("#editBookPublish").val()
      var editBookISBN = $("#editBookISBN").val()
      var newRowData = [].concat(editBookName, editBookAuthor, editBookPrice, editBookPublish, editBookISBN);
      var tds = Array.prototype.slice.call($('.selected td'))
      for (var i = 0; i < newRowData.length; i++) {
        if (newRowData[i] !== '') {
          tds[i + 1].innerHTML = newRowData[i];
        } else {
          alert(titles[i] + '内容不能为空')
        }
      }    
    })

    $("#cancelEdit").click(function() {
      console.log('cancelAdd');
      $("#editBookModal").find('input').val('')
    })

    $('#btn_delete').click(function () {
      if (table.rows('.selected').data().length) {
        $("#deleteBook").modal()
      } else {
        alert('请选择项目');
      }
    });

    $('#delete').click(function () {
      console.log(table.rows('.selected').data()[0].radarmaintenanceId)
      $.ajax({
        type:"post",
            url:"http://127.0.0.1:8081/delete",
            async:true,
            data:{
                datalength:table.rows('.selected').data().length,
                deldata: table.rows('.selected').data()[0].radarmaintenanceId
      }
      }
      )
      table.row('.selected').remove().draw(false);


    });

  })
  function addUser() {
        $.ajax({  
            type:"post",
            url:"/user/add",
            async:true,
            data:{
                userName: $("#addUserName").val(),
                userAddr: $("#addUserAddr").val(),
                status: $("#addStatus").val(),
                roleId: $("#addRole").val()
            },
            success:function(res){
                // 刷新表格数据，分页信息不会重置
                firstTable.ajax.reload(null,false);
                //清空添加表单数据
                clearAddData();
                alert(res)
            }
        });
    }

    function deleteData(id) {
        $.ajax({
            type:"get",
            url:"/user/delete",
            async:true,
            data:{
                userId: id
            },
            success:function(res){
                // 刷新表格数据，分页信息不会重置
                firstTable.ajax.reload(null,false);

                alert(res)
            }
        });
    }

  

</script>

</html>